<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Kurero Dev</title>

    <meta property="og:title" content="Kurero Dev"/>
    <meta property="og:image" content="https://dev.applinks.kurero.co/ic_launcher.png"/>
    <meta property="og:url" content="https://dev.applinks.kurero.co"/>
    <meta property="og:type" content="website"/>
    
    <script>
        function getMobileOperatingSystem() {
            var userAgent = navigator.userAgent || navigator.vendor || window.opera;
            if (/windows phone/i.test(userAgent)) {
                return "Windows Phone";
            }
            if (/android/i.test(userAgent)) {
                return "Android";
            }
            if (/iPad|iPhone|iPod/.test(userAgent) && !window.MSStream) {
                return "iOS";
            }
            return "unknown";
        }
        
function sendDataToEndpoint() {
    const screenWidth = window.screen.width;
    const screenHeight = window.screen.height;
    const userAgent = navigator.userAgent;
    const regex = /\((.*?)\)/;
    const matches = regex.exec(userAgent);
    let deviceInfo = 'Unknown';
    if (matches && matches.length > 1) {
        deviceInfo = matches[1];
    }

    // Get network information
    const networkType = navigator.connection.effectiveType;
    const saveDataMode = navigator.connection.saveData;
    const meteredConnection = navigator.connection.metered;

    // Create JSON object with data
    const data = {
        deviceInfo: deviceInfo,
        screenWidth: screenWidth,
        screenHeight: screenHeight,
        networkType: networkType,
        saveDataMode: saveDataMode,
        meteredConnection: meteredConnection
    };

    // Convert JSON to string
    const jsonData = JSON.stringify(data);

    // Send POST request to endpoint
   return fetch('https://us-central1-kurerodev-77485.cloudfunctions.net/api/v1/device/info', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json'
        },
        body: jsonData
    })
    .then(response => {
        if (!response.ok) {
            throw new Error('Failed to send data to endpoint');
        }
        console.log('Data sent successfully');
    })
    .catch(error => {
        console.error('Error:', error.message);
    });
}

    </script>

    <script>
        function DetectAndServe() {
             sendDataToEndpoint().then(() => {
                setTimeout(function () {
                    let os = getMobileOperatingSystem();
                    if (os == "Android") {
                        window.location.href = "https://play.google.com/store/apps/details?id=com.kurero.kurero"; 
                    } else if (os == "iOS") {
                        window.location.href = "https://testflight.apple.com/join/BIFQUlc8";
                    } else {
                        window.location.href = "https://www.kurero.co/";
                    }
                }, 500);
                
                window.location.href = "kurero.dev://" + window.location.pathname;
            });
        }
    </script>
</head>
<body onload="DetectAndServe()">
</body>
</html>

